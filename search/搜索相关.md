# 面向搜索

## 索引 -> 【倒排索引】什么是倒排索引 --index
es构建文档时，首先将文档内容分词/分析，生成文档包含的词项，再对文档相关的词项构建，搜索字典树，
进而构建，词项到文档ID的倒排索引

关键词 到 包含关键词文档id的映射表
aa -> 文档1、文档2、文档3..
bb -> 文档1、文档3

#### 1、正向索引，数据行有那些特征
例如传统关系型数据库：在数据行上构建某个特征的索引。
###### 1.1 --doc_values
ES 通过转置倒排索引来支持聚合，排序

文档1 -> 10
文档2 -> 20
文档3 -> 30

###### 1.2 doc_values 存储到磁盘前的压缩技巧
Doc Values 在压缩过程中使用如下技巧。它会按依次检测以下压缩模式:

如果所有的数值各不相同（或缺失），设置一个标记并记录这些值
如果这些值小于 256，将使用一个 简单的编码表
如果这些值大于 256，检测是否存在一个 最大公约数压缩模式不是
如果没有存在最大公约数，从最小的数值开始，统一计算 偏移量 进行编码
你会发现这些传统的通用的压缩方式，比如 DEFLATE 或是 `LZ4`。 
因为列式存储的结构是严格且良好定义的，我们可以通过使用专门的模式来达到比通用压缩算法（如 LZ4 ）更高的压缩效果。

String 类型的压缩，通过借助 顺序表（ordinal table），String 类型也是类似进行编码的。
String 类型是去重之后存放到顺序表的，通过分配一个 ID`，然后通过数字类型的 `ID 构建 Doc Values`。
这样 `String 类型和数值类型可以达到同样的压缩效果。顺序表本身也有很多压缩技巧，比如固定长度、变长或是前缀字符编码等等。


#### 2、特征包含哪些定位数据的唯一 id
是一个特征 - 【满足特征文档集合】 的映射表
词项 / 特征： 文档 映射表 
例如：
like  1     2   
fox   2     5
tea   5
ES 内部会记录单词对应文档的id, 词位置偏移量，词频，相关度等信息

#### 更复杂的
在构建全文搜索时会引入标准化、分词、相关性分析、评分等【_analyze】

参考资料：https://www.elastic.co/guide/cn/elasticsearch/guide/current/inverted-index.html

### 相关性分析# 

### _all
它连接所有字段的值构成一个用空格（space）分隔的大string，该string被analyzed和index
